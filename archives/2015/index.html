<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>halfcrazy在疯言疯语</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="我的个人博客，python，vim，linux">
<meta property="og:type" content="website">
<meta property="og:title" content="halfcrazy在疯言疯语">
<meta property="og:url" content="http://halfcrazy.me/archives/2015/index.html">
<meta property="og:site_name" content="halfcrazy在疯言疯语">
<meta property="og:description" content="我的个人博客，python，vim，linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="halfcrazy在疯言疯语">
<meta name="twitter:description" content="我的个人博客，python，vim，linux">
  
    <link rel="alternative" href="/atom.xml" title="halfcrazy在疯言疯语" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.lug.ustc.edu.cn/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45587350-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">halfcrazy在疯言疯语</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://halfcrazy.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-python中的装饰器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/16/python中的装饰器/" class="article-date">
  <time datetime="2015-03-16T04:43:33.000Z" itemprop="datePublished">Mar 16 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/技巧/">技巧</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/16/python中的装饰器/">python中的装饰器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在python中有一种动态修改函数的机制，叫做<strong>装饰器</strong>。<br>先上一个小例子<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="decorator">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> args</span><br><span class="line">        fn(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure></p>
<p>这里定义了一个<code>plus</code>函数，它接收两个参数并返回两个参数相加的结果。又定义了一个函数<code>log</code>，它接收一个函数做参数，并且先输出该函数的参数列表，再执行该函数。这里的<code>log</code>就起到了装饰器的作用。</p>
<p>下面来解释一下装饰器的行为</p>
<p>这里的<code>@log</code>实际起到的作用相当于<code>plus = log(plus)</code>即，修改plus本身变成一个新的函数。再往下展开一次就变成了<code>plus = log(plus) = wrapper</code>。所以我们现在来看<code>wrapper</code>函数的参数，这里的<code>*args,**kwargs</code>实际就是被装饰函数的参数列表。</p>
<p>值得注意的是，对函数应用装饰器后，由于函数实质上是变成了一个新的函数，所以函数的部分属性会发送更改，比如<code>__name__</code>，如果说是专门为了保存原函数的这个属性，在新函数内部单独写上属性拷贝语句那就太不pythonic了。python为我们提供了<code>functools.wraps</code>方法。对于上面的例子，我们只需进行一行改写就可以保存原函数的属性。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="decorator">@functools.wraps(fn)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> args</span><br><span class="line">        fn(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">    </span><br><span class="line"><span class="decorator">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure></p>
<p>是不是很简单。</p>
<hr>
<p>接下来说一说<strong>带参数的装饰器</strong></p>
<p>还是以上面的例子为例，如果我们现在不止是希望<code>plus</code>在调用时可以输出参数，并且希望它能加上一个限制条件，只输出符合限制条件的参数。那么我们就可以对装饰器进行修改，调整现在<code>log</code>的行为。</p>
<p>如果希望加上<code>@log(5)</code>可以使<code>plus</code>只输出大于5的参数，并返回结果，那么可以按照下面的写法来。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(fn)</span>:</span></span><br><span class="line">        <span class="decorator">@functools.wraps(fn)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            <span class="keyword">print</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> args <span class="keyword">if</span> x &gt; num]</span><br><span class="line">            fn(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line">    </span><br><span class="line"><span class="decorator">@log(5)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://halfcrazy.me/2015/03/16/python中的装饰器/" data-id="ci7bn960q000zncygqas3fyuq" class="article-share-link">Share</a>
      
        <a href="http://halfcrazy.me/2015/03/16/python中的装饰器/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/decorator/">decorator</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-使用Privoxy将socks5代理转http代理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/使用Privoxy将socks5代理转http代理/" class="article-date">
  <time datetime="2015-03-11T09:30:05.000Z" itemprop="datePublished">Mar 11 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/工具/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/使用Privoxy将socks5代理转http代理/">使用Privoxy将socks5代理转http代理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>由于某些特殊需要，需要将socks5代理转换成http代理，找到的工具是<a href="http://www.privoxy.org" target="_blank" rel="external">Privoxy</a></p>
<p>操作步骤很简单，安装好后找到安装目录下的config.txt</p>
<p>编辑其中的两行</p>
<p>其中 <code>listen-address 127.0.0.1:8118</code> 这一行是指出转成http代理后本地的代理ip和端口，这行默认不带注释，可以留着默认配置</p>
<p>还有一行没有，需要手动添加 <code>forward-socks5 / 127.0.0.1:9050 .</code> 这里需要注意的是不要丢掉行尾的<code>.</code>句号</p>
<p>现在配置完成，打开Privoxy即可使用本地的http代理了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://halfcrazy.me/2015/03/11/使用Privoxy将socks5代理转http代理/" data-id="ci7bn960a000sncygnjvjb862" class="article-share-link">Share</a>
      
        <a href="http://halfcrazy.me/2015/03/11/使用Privoxy将socks5代理转http代理/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Privoxy/">Privoxy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代理/">代理</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-URI中的大小写" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/URI中的大小写/" class="article-date">
  <time datetime="2015-03-11T09:30:05.000Z" itemprop="datePublished">Mar 11 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/杂谈/">杂谈</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/URI中的大小写/">url中的大小写</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>统一资源定位符的标准格式如下：</p>
<blockquote>
<p>协议类型://服务器地址（必要时需加上端口号）/路径/文件名</p>
</blockquote>
<p>其中协议名，和服务器地址不大小写敏感的。也就是说<br><a href="http://www.douban.com" target="_blank" rel="external">http://www.douban.com</a> 和 hTTp://WwW.DOUBAn.CoM 是访问到的一个地址。因为dns不区分大小写。</p>
<p>接着是路径名，路径名是否大小写敏感取决于服务器的设置，一般是看具体框架的路由是不是大小写敏感，也有的是可以认为设置。</p>
<p>再然后是文件名，文件名取决于操作系统和服务器设置，如果是直接映射到系统文件目录的话，那么要看操作系统。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://halfcrazy.me/2015/03/11/URI中的大小写/" data-id="ci7bn9615001incygdfcmw8kv" class="article-share-link">Share</a>
      
        <a href="http://halfcrazy.me/2015/03/11/URI中的大小写/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-git忽略vim临时文件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/08/git忽略vim临时文件/" class="article-date">
  <time datetime="2015-02-08T15:29:31.000Z" itemprop="datePublished">Feb 8 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tricks/">tricks</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/08/git忽略vim临时文件/">git忽略vim临时文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>参考链接<a href="http://stackoverflow.com/questions/4824188/git-ignore-vim-temporary-files" target="_blank" rel="external">git忽略vim临时文件</a></p>
</blockquote>
<p>在使用git时，由于vim每当保存文件就会在当前目录下生成一个<code>文件名~</code>的临时文件，往往会导致<code>git add .</code>命令自动把这个临时文件也包含进去。通常应对这个问题的办法是使用一个<code>.gitignore</code>的文件来设定一个规则从而忽略这些文件。不过通常的<code>.gitignore</code>模板中大多是一些ide(idea，eclipse之流)的项目文件夹，或者中间文件(.pyc之类)。</p>
<p>由于vim经常会被用来写一些不同语言/项目的代码，如果针对这些每一种语言/项目的<code>.gitignore</code>模板都添加<code>*~</code>这一行未免过于麻烦，这时有一种通用的解决办法</p>
<blockquote>
<p><code>git config --global core.excludesfile ~/.gitignore</code>命令会全局的忽略包含在<code>.gitignore</code>中的文件/文件夹。</p>
</blockquote>
<p>这样，将那些通用的规则写在这里，再对不同的语言/项目应用它们独自的<code>.gitignore</code>模板就会省事的多。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://halfcrazy.me/2015/02/08/git忽略vim临时文件/" data-id="ci7bn960q0016ncygzff0gq2i" class="article-share-link">Share</a>
      
        <a href="http://halfcrazy.me/2015/02/08/git忽略vim临时文件/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/">vim</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-理解CSRF" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/03/理解CSRF/" class="article-date">
  <time datetime="2015-02-03T07:17:39.000Z" itemprop="datePublished">Feb 3 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/译文/">译文</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/03/理解CSRF/">理解CSRF(跨站请求伪造)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>原文出处<a href="https://github.com/pillarjs/understanding-csrf" target="_blank" rel="external">Understanding CSRF</a></p>
</blockquote>
<p>对于Express团队的<a href="https://github.com/pillarjs/csurf" target="_blank" rel="external">csrf</a>模块有一些关注，尤其是围绕着如何安全的生成token。<br>这些关注是莫须有的，因为他们不了解CSRF token是如何工作的。<br>下面快速过一遍！</p>
<p>读过后还有疑问？希望告诉我们错误？请开一个issue！</p>
<h2 id="一个CSRF攻击是如何工作的？">一个CSRF攻击是如何工作的？</h2><p>在他们的钓鱼站点，攻击者可以针对你的网站创建一个请求通过创建一个AJAX按钮或者表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"https://my.site.com/me/something-destructive"</span> <span class="attribute">method</span>=<span class="value">"POST"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Click here for free money!<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是很危险的，因为攻击者可以使用其他http方法例如 <code>delete</code> 来获取结果。<br>这在用户的session中有很多关于你的网站的详细信息时是相当危险的。如果一个不懂技术的用户遇到了，他们就有可能会输入信用卡号或者个人安全信息。</p>
<h2 id="如果减轻CSRF攻击？">如果减轻CSRF攻击？</h2><h3 id="禁用CORS">禁用CORS</h3><p>第一种减轻CSRF攻击的方法是禁用cross-origin requests(跨域请求)。<br>不要允许跨域请求!<br>如果你希望允许跨域请求，那么请只允许 <code>OPTIONS, HEAD, GET</code> 方法，并且不要支持sessions或者cookies!<br>他们是攻击者的主要目标。</p>
<p>一种推荐的做法是总是删除来自跨域请求的cookies在你处理来自这些请求的任何业务逻辑之前。<br>另外一种是检验header中的带的 <code>referrer</code> 。</p>
<h3 id="不要兼容旧浏览器">不要兼容旧浏览器</h3><p>但是请记住，CSRF在CORS实现之前就有。<br>并且对于不支持CORS的浏览器来说，这是一个大问题。<br>就我所知道的，这意味着IE10以前的所有浏览器。</p>
<p>因此，你可以不支持那些旧的浏览器！<br>这意味着查看那些特别的 <code>user-agent</code> 。<br>如果你只是不允许那些使用旧浏览器的用户登录或者存储任何个人信息，那也是可以的！</p>
<h3 id="CSRF_Tokens">CSRF Tokens</h3><p>最终的解决办法是使用CSRF tokens。<br>CSRF tokens是如何工作的呢？</p>
<ol>
<li>服务器发送给客户端一个token。</li>
<li>客户端提交的表单中带着这个token。</li>
<li>如果这个token不合法，那么服务器拒绝这个请求。</li>
</ol>
<p>因此，攻击者需要通过谋者办法获得一个合法的token来构造一个AJAX请求。<br>如果你允许了CORS，那么如果攻击者做起来就很简单，如果你暴露了token给客户端通过某种方式(显然你会把token发给客户端)。</p>
<p><strong>禁用 CORS!!!</strong><br>但是对于旧的浏览器，这相当简单，只要攻击者知道可以从哪里获取一个CSRF token。</p>
<p>这个token需要是不可猜测的，是它不会被攻击者尝试几次就猜出来。</p>
<p>最后一件事是不要创建一个类似 <code>/csrf</code> 之类的路由来获取token，那么攻击者就不会很容易获取一个CSRF token。</p>
<h2 id="BREACH攻击">BREACH攻击</h2><p>这也就是salt(加盐)出现的原因。<br>Breach攻击相当简单：如果服务器通过HTTPS+gzip多次发送相同或者相似的响应，攻击者就可以猜测响应的内容。解决办法？让每一个响应都有那么一点不同。<br>于是，CSRF tokens依据每一个不同的请求还有不同的时间来生成。<br>但是服务器需要知道客户端请求中带的token是否是合法的。<br>因此：</p>
<ol>
<li>一般认为安全加密的CSRF tokens是防护CSRF的关键</li>
<li>CSRF tokens现在通常是一个秘钥或者salt的hash</li>
</ol>
<p>了解更多:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/BREACH_(security_exploit)" target="_blank" rel="external">BREACH</a></li>
<li><a href="http://en.wikipedia.org/wiki/CRIME" target="_blank" rel="external">CRIME</a></li>
<li><a href="https://community.qualys.com/blogs/securitylabs/2013/08/07/defending-against-the-breach-attack" target="_blank" rel="external">Defending against the BREACH Attack</a></li>
</ul>
<h2 id="salt不需要加密">salt不需要加密</h2><p><strong>因为客户端知道salt!!!</strong><br>服务器会发送 <code>&lt;salt&gt;;&lt;token&gt;</code> ，然后客户端会通过请求返回相同的值给服务器。服务器然后会检验 <code>&lt;secret&gt;+&lt;salt&gt;=&lt;token&gt;</code> 。<br>salt必须跟token一起被发送给服务器，否则服务器不能验证这个token。<br>这是最简单的加密方式。<br>还有很多方法，不过他们更加复杂，犯不着那么麻烦。</p>
<h2 id="创建tokens必须要快">创建tokens必须要快</h2><p><strong>因为每当进来一个请求他们就会被创建!</strong><br>一些人希望salt通过 <code>crypto.randomBytes()</code> 来创建。<br>这个方法的问题在于，服务器会消耗很多资源，那么，响应速度就会不必要的变慢。<br>因此，一些人建议用 <code>crypto.pseudRandomBytes()</code> ,但是这也同样会导致不必要的变慢。</p>
<blockquote>
<p>注意: 在最新版本的io.js中不再有这个问题</p>
</blockquote>
<p>因此，类似 <code>Math.random().toString(36).slice(2)</code> 这种简单操作是相当高效的。</p>
<h2 id="秘钥不需要是加密的，但需要是安全的">秘钥不需要是加密的，但需要是安全的</h2><p>如果你正在使用一个数据库后端来存储session，客户端是不会知道秘钥的，因为它被存储在数据库中。<br>如果你正在使用cookie来存储session，那么秘钥就会被存储在cookie中发送给客户端。<br>因此， <strong>确保cookie sessions 使用 <code>httpOnly</code> 那样客户端就不能通过客户端JavaScript来读取到秘钥!</strong></p>
<p>即使攻击者可以通过某种手段获取到<code>secret</code>，他也必须要通过CORS请求。</p>
<h2 id="CSRF攻击只和浏览器有关">CSRF攻击只和浏览器有关</h2><p>如果你正在使用浏览器的开发工具或者其他一般人不会使用到的工具，那你的担心是没有道理的。<br>使用不同的工具有很多种攻击网站的办法，但是CSRF的主要关注点是阻止那些对于不懂技术又使用旧浏览器的使用者的攻击。对于CSRF tokens的一个主要假设是，攻击者不会接触到的受害者的电脑，否则他有比CSRF更好的办法去攻击受害者的电脑。</p>
<h2 id="CSRF_tokens最终会变得不是那么必要">CSRF tokens最终会变得不是那么必要</h2><p>随着现代浏览器支持CORS以及安全策略，CSRF tokens最终会消失。<br>不用太担心CSRF tokens。<br>对于现在来说，禁止IE9及其以下的浏览器存储你网站的机密信息。<br>但是为了安全起见，你还是应该尽量允许他们尤其是当难以实现的时候。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://halfcrazy.me/2015/02/03/理解CSRF/" data-id="ci7bn95zf0001ncyggf6821y9" class="article-share-link">Share</a>
      
        <a href="http://halfcrazy.me/2015/02/03/理解CSRF/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSRF/">CSRF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/安全/">安全</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/tricks/">tricks</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技巧/">技巧</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/译文/">译文</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSRF/">CSRF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PSP/">PSP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Privoxy/">Privoxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bower/">bower</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decorator/">decorator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/">gulp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代理/">代理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/团队/">团队</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/怪物猎人/">怪物猎人</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化/">自动化</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSRF/" style="font-size: 10px;">CSRF</a><a href="/tags/PSP/" style="font-size: 10px;">PSP</a><a href="/tags/Privoxy/" style="font-size: 10px;">Privoxy</a><a href="/tags/bower/" style="font-size: 10px;">bower</a><a href="/tags/decorator/" style="font-size: 10px;">decorator</a><a href="/tags/git/" style="font-size: 10px;">git</a><a href="/tags/gulp/" style="font-size: 10px;">gulp</a><a href="/tags/python/" style="font-size: 10px;">python</a><a href="/tags/vim/" style="font-size: 10px;">vim</a><a href="/tags/web/" style="font-size: 10px;">web</a><a href="/tags/代理/" style="font-size: 10px;">代理</a><a href="/tags/前端/" style="font-size: 20px;">前端</a><a href="/tags/团队/" style="font-size: 10px;">团队</a><a href="/tags/安全/" style="font-size: 10px;">安全</a><a href="/tags/怪物猎人/" style="font-size: 10px;">怪物猎人</a><a href="/tags/网络/" style="font-size: 10px;">网络</a><a href="/tags/自动化/" style="font-size: 10px;">自动化</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/03/16/python中的装饰器/">python中的装饰器</a>
          </li>
        
          <li>
            <a href="/2015/03/11/使用Privoxy将socks5代理转http代理/">使用Privoxy将socks5代理转http代理</a>
          </li>
        
          <li>
            <a href="/2015/03/11/URI中的大小写/">url中的大小写</a>
          </li>
        
          <li>
            <a href="/2015/02/08/git忽略vim临时文件/">git忽略vim临时文件</a>
          </li>
        
          <li>
            <a href="/2015/02/03/理解CSRF/">理解CSRF(跨站请求伪造)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 halfcrazy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'halfcrazy';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.lug.ustc.edu.cn/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>